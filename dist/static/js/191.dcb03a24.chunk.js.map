{"version":3,"file":"static/js/191.dcb03a24.chunk.js","mappings":"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","sources":["views/formily/jsonSchemaForm.jsx","views/formily/jsonshema.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { createForm } from '@formily/core';\r\nimport {\r\n  Card,\r\n  Spin,\r\n} from 'antd';\r\nimport {\r\n  Form,\r\n  FormItem,\r\n  FormGrid,\r\n  FormLayout,\r\n  Input,\r\n  DatePicker,\r\n  Cascader,\r\n  Select,\r\n  // IDUpload,\r\n  ArrayItems,\r\n  Editable,\r\n} from '@formily/antd';\r\nimport { createSchemaField } from '@formily/react';\r\nimport { action } from '@formily/reactive';\r\nimport { jsonShemaConfig, defaultFormData, formatLocationOptions } from './jsonshema';\r\n\r\n// // 创建表单实例\r\nconst jsonFormInstance = createForm();\r\n// // 创建schema实例\r\nconst SchemaField = createSchemaField({\r\n  components: {\r\n    FormItem,\r\n    FormGrid,\r\n    FormLayout,\r\n    Input,\r\n    DatePicker,\r\n    Cascader,\r\n    Select,\r\n    ArrayItems,\r\n    Editable,\r\n  },\r\n});\r\n// // 地址下拉数据源赋值操作\r\nconst setLocationOptions = (data) => {\r\n  jsonFormInstance && jsonFormInstance.setFieldState('address', (state) => {\r\n    state.dataSource = data;\r\n  });\r\n};\r\n\r\n// // 组件\r\nconst JsonForm = () => {\r\n  // TODO: 常见表单复用【新增、编辑、详情】\r\n  const [formTitle, setFormTitle] = useState('编辑');\r\n\r\n  // // loading\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const closeLoading = () => {\r\n    setLoading(false);\r\n  };\r\n\r\n  // 获取下拉数据源\r\n  const getLocationOptionData = () => {\r\n    fetch('//unpkg.com/china-location/dist/location.json')\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        setLocationOptions(formatLocationOptions(data));\r\n        closeLoading();\r\n      });\r\n  };\r\n\r\n  const configFormData = () => {\r\n    // // 模拟常规：mounted时发请求并设置表单初始值\r\n    jsonFormInstance.setInitialValues(defaultFormData);\r\n  };\r\n  const initFormData = () => {\r\n    getLocationOptionData();\r\n    configFormData();\r\n  };\r\n\r\n  useEffect(() => {\r\n    // 表单数据初始化\r\n    initFormData();\r\n    return () => {\r\n      // componentWillUnmount....\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <Card title={formTitle + '用户'}>\r\n      <Spin spinning={loading}>\r\n        <Form\r\n          form={jsonFormInstance}\r\n          labelCol={5}\r\n          wrapperCol={16}\r\n        >\r\n          <SchemaField schema={jsonShemaConfig} />\r\n        </Form>\r\n      </Spin>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default JsonForm;\r\n","export const jsonShemaConfig = {\r\n  type: 'object',\r\n  properties: {\r\n    username: {\r\n      type: 'string',\r\n      title: '用户名',\r\n      required: true,\r\n      'x-decorator': 'FormItem',\r\n      'x-component': 'Input',\r\n    },\r\n    name: {\r\n      type: 'void',\r\n      title: '姓名',\r\n      'x-decorator': 'FormItem',\r\n      'x-decorator-props': {\r\n        asterisk: true,\r\n        feedbackLayout: 'none',\r\n      },\r\n      'x-component': 'FormGrid',\r\n      properties: {\r\n        firstName: {\r\n          type: 'string',\r\n          required: true,\r\n          'x-decorator': 'FormItem',\r\n          'x-component': 'Input',\r\n          'x-component-props': {\r\n            placeholder: '姓',\r\n          },\r\n        },\r\n        lastName: {\r\n          type: 'string',\r\n          required: true,\r\n          'x-decorator': 'FormItem',\r\n          'x-component': 'Input',\r\n          'x-component-props': {\r\n            placeholder: '名',\r\n          },\r\n        },\r\n      },\r\n    },\r\n    email: {\r\n      type: 'string',\r\n      title: '邮箱',\r\n      required: true,\r\n      'x-decorator': 'FormItem',\r\n      'x-component': 'Input',\r\n      'x-validator': 'email',\r\n    },\r\n    gender: {\r\n      type: 'string',\r\n      title: '性别',\r\n      enum: [\r\n        {\r\n          label: '男',\r\n          value: 1,\r\n        },\r\n        {\r\n          label: '女',\r\n          value: 2,\r\n        },\r\n        {\r\n          label: '第三性别',\r\n          value: 3,\r\n        },\r\n      ],\r\n      'x-decorator': 'FormItem',\r\n      'x-component': 'Select',\r\n    },\r\n    birthday: {\r\n      type: 'string',\r\n      required: true,\r\n      title: '生日',\r\n      'x-decorator': 'FormItem',\r\n      'x-component': 'DatePicker',\r\n    },\r\n    address: {\r\n      type: 'string',\r\n      required: true,\r\n      title: '地址',\r\n      'x-decorator': 'FormItem',\r\n      'x-component': 'Cascader',\r\n      // 改为手动发请求初始数据\r\n      // 'x-reactions': '{{fetchAddress}}',\r\n    },\r\n    // idCard: {\r\n    //   type: 'string',\r\n    //   required: true,\r\n    //   title: '身份证复印件',\r\n    //   'x-decorator': 'FormItem',\r\n    //   'x-component': 'IDUpload',\r\n    // },\r\n    contacts: {\r\n      type: 'array',\r\n      required: true,\r\n      title: '联系人信息',\r\n      'x-decorator': 'FormItem',\r\n      'x-component': 'ArrayItems',\r\n      items: {\r\n        type: 'object',\r\n        'x-component': 'ArrayItems.Item',\r\n        properties: {\r\n          sort: {\r\n            type: 'void',\r\n            'x-decorator': 'FormItem',\r\n            'x-component': 'ArrayItems.SortHandle',\r\n          },\r\n          popover: {\r\n            type: 'void',\r\n            title: '完善联系人信息',\r\n            'x-decorator': 'Editable.Popover',\r\n            'x-component': 'FormLayout',\r\n            'x-component-props': {\r\n              layout: 'vertical',\r\n            },\r\n            'x-reactions': [\r\n              {\r\n                fulfill: {\r\n                  schema: {\r\n                    title: '{{$self.query(\".name\").value() }}',\r\n                  },\r\n                },\r\n              },\r\n            ],\r\n            properties: {\r\n              name: {\r\n                type: 'string',\r\n                title: '姓名',\r\n                required: true,\r\n                'x-decorator': 'FormItem',\r\n                'x-component': 'Input',\r\n                'x-component-props': {\r\n                  style: {\r\n                    width: 300,\r\n                  },\r\n                },\r\n              },\r\n              email: {\r\n                type: 'string',\r\n                title: '邮箱',\r\n                'x-decorator': 'FormItem',\r\n                'x-component': 'Input',\r\n                'x-validator': [{ required: true }, 'email'],\r\n                'x-component-props': {\r\n                  style: {\r\n                    width: 300,\r\n                  },\r\n                },\r\n              },\r\n              phone: {\r\n                type: 'string',\r\n                title: '手机号',\r\n                'x-decorator': 'FormItem',\r\n                'x-component': 'Input',\r\n                'x-validator': [{ required: true }, 'phone'],\r\n                'x-component-props': {\r\n                  style: {\r\n                    width: 300,\r\n                  },\r\n                },\r\n              },\r\n            },\r\n          },\r\n          remove: {\r\n            type: 'void',\r\n            'x-decorator': 'FormItem',\r\n            'x-component': 'ArrayItems.Remove',\r\n          },\r\n        },\r\n      },\r\n      properties: {\r\n        addition: {\r\n          type: 'void',\r\n          title: '新增联系人',\r\n          'x-component': 'ArrayItems.Addition',\r\n        },\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nexport const defaultFormData = {\r\n  username: 'chengyouthree',\r\n  firstName: 'cheng',\r\n  lastName: '....',\r\n  email: 'fuckjerry@nobody.com',\r\n  gender: 1,\r\n  birthday: '2050-01-03',\r\n  address: ['110000', '110000', '110101'],\r\n  idCard: [\r\n    {\r\n      name: 'this is image',\r\n      thumbUrl:\r\n        'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\r\n      uid: 'rc-upload-1615825692847-2',\r\n      url: 'https://zos.alipayobjects.com/rmsportal/jkjgkEfvpUPVyRjUImniVslZfWPnJuuZ.png',\r\n    },\r\n  ],\r\n  contacts: [\r\n    { name: '张三', phone: '13245633378', email: 'zhangsan@gmail.com' },\r\n    { name: '李四', phone: '16873452678', email: 'lisi@gmail.com' },\r\n  ],\r\n};\r\n\r\n// // 格式化后台行政下拉数据源\r\nexport const formatLocationOptions = (data = {}) => {\r\n  const getKeyValueList = (obj = {}) => Object.entries(obj) || [];\r\n\r\n  return getKeyValueList(data).map(([provinceCode, provinceObj]) => ({\r\n    value: provinceCode,\r\n    label: provinceObj.name,\r\n    children: getKeyValueList(provinceObj.cities).map(([cityCode, cityObj]) => ({\r\n      value: cityCode,\r\n      label: cityObj.name,\r\n      children: getKeyValueList(cityObj.districts).map(([code, name]) => ({\r\n        value: code,\r\n        label: name,\r\n        children: null\r\n      }))\r\n    }))\r\n  }));\r\n};\r\n"],"names":["jsonFormInstance","createForm","SchemaField","createSchemaField","components","FormItem","FormGrid","FormLayout","Input","DatePicker","Cascader","Select","ArrayItems","Editable","useState","formTitle","loading","setLoading","getLocationOptionData","fetch","then","res","json","data","setFieldState","state","dataSource","setLocationOptions","formatLocationOptions","initFormData","setInitialValues","defaultFormData","useEffect","title","spinning","form","labelCol","wrapperCol","schema","jsonShemaConfig","type","properties","username","required","name","asterisk","feedbackLayout","firstName","placeholder","lastName","email","gender","enum","label","value","birthday","address","contacts","items","sort","popover","layout","fulfill","style","width","phone","remove","addition","idCard","thumbUrl","uid","url","getKeyValueList","obj","Object","entries","map","provinceCode","provinceObj","children","cities","cityCode","cityObj","districts"],"sourceRoot":""}